# 修仙採集系統 - 完整實作說明

## 系統概述

這是一個完整的修仙風格採集系統，包含職業品級、工具階級、採集成功率、心魔機制等功能。

## 核心概念

### 職業品級系統
- **0品**: 未入門
- **9品-1品**: 煉氣期到築基期，品級越低越高級
- 每個品級需要對應的經驗值才能晉升

### 工具階級系統
- **黃階**: 基礎工具，50耐久，無加成
- **玄階**: 進階工具，100耐久，20%經驗加成，5%成功率加成
- **地階**: 高級工具，無耐久限制，60%經驗加成，10%成功率加成
- **天階**: 頂級工具，無耐久限制，100%經驗加成，20%成功率加成，附帶隨機詞條

### 採集產物類型
- **普通產物**: 基礎成功率80%，失敗扣血，成功給5點經驗
- **稀有產物**: 基礎成功率50%，失敗扣血，成功給10點經驗，有1%機率獲得天材地寶
- **天材地寶**: 特殊產物，從稀有產物採集成功時有機率額外獲得

## 採集規則詳解

### 同品級採集
- **普通產物**: 80%基礎成功率 + 工具加成
- **稀有產物**: 50%基礎成功率 + 工具加成 + 累積成功率
- 使用玄階以上工具採集稀有產物失敗時，該產物永久增加成功率(最高80%)
    - 玄階: +0.5%
    - 地階/天階: +1%

### 低品級採集
- 採集比自己品級低的產物100%成功
- 不給予職業經驗
- 稀有產物仍有1%機率獲得天材地寶
- 天材地寶每日有出現上限(預設10次)

### 高一品級採集(越級挑戰)
- **普通產物**: 50%成功率，失敗扣血，40%機率產生心魔，成功給20點經驗
- **稀有產物**: 10%成功率，失敗則**殺死角色並扣除修為**，80%機率產生心魔，成功給40點經驗
- 無法獲得天材地寶

### 首次成功獎勵
每個品級的稀有產物首次採集成功時：
- 額外獲得160點職業經驗
- 獲得天材地寶
- 全服公告
- 獲得成就和稱號

### 心魔機制
- 心魔狀態下，所有採集成功率減半
- 心魔狀態下無法獲得天材地寶
- 需要特殊方法清除心魔(如使用命令或特殊道具)

## 天階工具詞條系統

天階工具隨機附帶以下七種詞條之一：

1. **詞條一**: 採集高一階產物成功率+10%，不觸發心魔
2. **詞條二**: 採集同階稀有產物獲得天材地寶機率上升至5%
3. **詞條三**: 採集同階或高一階產物成功額外給予100%職業經驗加成
4. **詞條四**: 採集高一階普通產物必定成功
5. **詞條五**: 採集同階普通或稀有產物有30%機率給予2個物品
6. **詞條六**: 採集高一階產物套用基礎成功率，但無成功率加成，且無稀有產物首次成功獎勵
7. **詞條七**: 採集成功時，回復氣血與真元

使用重鑄石可以重新隨機天階工具的詞條。

## 指令系統

管理員可使用以下指令：

```
/harvest info [玩家]           - 查詢職業信息
/harvest setrank <玩家> <品級>  - 設置職業品級(0-9)
/harvest addexp <玩家> <經驗>   - 添加職業經驗
/harvest cleardemon [玩家]     - 清除心魔狀態
/harvest reset <玩家>          - 重置職業數據
```

## 實作清單

### 已完成
✅ 核心採集系統
✅ 工具階級系統
✅ 成功率計算
✅ 心魔機制
✅ 天階工具詞條系統
✅ 首次成功獎勵
✅ 耐久度系統
✅ 累積成功率系統
✅ 天材地寶每日限制
✅ 指令系統
✅ NBT數據存儲
✅ Capability系統

### 需要補充
❌ 修為系統整合(死亡扣除修為)
❌ 真元系統整合(詞條七的真元恢復)
❌ 境界系統整合(晉升條件：境界+經驗+任務)
❌ 任務系統(晉升任務)
❌ 煉器系統(工具製作)
❌ NPC交易系統(購買黃階工具)
❌ 成就系統(首次成功成就)
❌ 稱號系統(首次成功稱號)
❌ 實際掉落物表(目前只有提示訊息)
❌ 天材地寶掉落邏輯
❌ 方塊生成配置(世界生成)

## 註冊物品和方塊示例

查看 `ModItems示例.java` 和 `ModBlocks示例.java` 了解如何註冊採集工具和可採集方塊。

你需要為每個品級(1-9)和每個階級(天地玄黃)創建完整的工具，以及為每個品級創建普通、稀有、天材地寶三種方塊。

## 配置建議

### 經驗需求配置
當前設定：
- 9品 → 8品: 100經驗
- 8品 → 7品: 400經驗
- 7品 → 6品: 1,300經驗
- 6品 → 5品: 4,000經驗
- 5品 → 4品: 12,100經驗
- 4品 → 3品: 36,400經驗
- 3品 → 2品: 109,300經驗
- 2品 → 1品: 328,000經驗
- 1品升級: 984,100經驗

### 耐久度配置
- 黃階: 50次使用
- 玄階: 100次使用
- 地階: 無限
- 天階: 無限

## 整合建議

1. **修為系統**: 在 `handleFailure` 方法中整合你的修為扣除邏輯
2. **真元系統**: 在詞條七的處理中整合真元恢復
3. **境界系統**: 創建職業晉升NPC或GUI，檢查境界、經驗、任務完成度
4. **煉器系統**: 創建煉器配方，允許玩家製作工具
5. **掉落物**: 在 `handleSuccess` 方法中實作實際的物品掉落

## 注意事項

1. 所有玩家數據通過Capability系統持久化保存
2. 心魔狀態會在玩家死亡後保留
3. 累積成功率會永久保存在玩家數據中
4. 天階工具的詞條在創建時隨機生成
5. 重鑄石只能用於天階工具

## 擴展建議

1. 添加更多詞條類型
2. 創建職業專精系統(不同職業有不同採集對象)
3. 添加團隊採集加成
4. 創建採集競技場
5. 添加季節或時間影響採集成功率
6. 創建稀有事件(暴擊採集、連續採集獎勵等)